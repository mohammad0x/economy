{% extends "base.html" %}
{% block title %}داشبورد{% endblock %}

{% block content %}
<div class="dashboard-wrapper">

    <!-- کارت‌های آمار -->
    <div class="stats-container">
        <div class="stat-box">
            <i class="fa-solid fa-chart-line icon"></i>
            <span class="count">{{ total_funds }}</span>
            <p>صندوق‌ها</p>
        </div>
        <div class="stat-box">
            <i class="fa-solid fa-hand-holding-heart icon"></i>
            <span class="count">{{ total_deprivations }}</span>
            <p>افراد محروم</p>
        </div>
        <div class="stat-box">
            <i class="fa-solid fa-file-lines icon"></i>
            <span class="count">{{ total_reports }}</span>
            <p>گزارش‌ها</p>
        </div>
        <div class="stat-box">
            <i class="fa-solid fa-users icon"></i>
            <span class="count">{{ total_users }}</span>
            <p>کاربران</p>
        </div>
    </div>

    <!-- نمودارها -->
    <div class="charts-container">
        <div class="chart-box">
            <h3>وضعیت دوره صندوق‌ها</h3>
            <canvas id="chartFundsCourse"></canvas>
        </div>
        <div class="chart-box">
            <h3>وام‌ها و موجودی</h3>
            <canvas id="chartFundLoans"></canvas>
        </div>
        <div class="chart-box large">
            <h3>تایم‌لاین گزارش‌ها</h3>
            <canvas id="chartReportsTimeline"></canvas>
        </div>
    </div>

    <!-- اعضای صندوق (مثال کارت‌محور) -->
    <div class="cards-section">
        <h3>اعضای صندوق</h3>
        <div class="cards-container">
            {% for user in users %}
            <div class="card">
                <h4>{{ user.username }}</h4>
                <p><strong>تلفن:</strong> {{ user.phone }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- دوره‌های مالی (مثال کارت‌محور) -->
    <div class="cards-section">
        <h3>دوره‌های مالی</h3>
        <div class="cards-container">
            {% for fund in funds %}
            <div class="card">
                <h4>{{ fund.fund.name }}</h4>
                <p><strong>تعداد اعضا:</strong> {{ fund.member }}</p>
                <p><strong>موجودی:</strong> {{ fund.quantity }}</p>
                <p><strong>تعداد وام‌ها:</strong> {{ fund.NumberOfLoans }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

</div>

<style>
/* Wrapper کلی */
.dashboard-wrapper {
    max-width: 1200px;
    margin: 50px auto;
    padding: 0 15px;
}

/* کارت‌های آمار */
.stats-container {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin-bottom: 40px;
    flex-wrap: wrap;
}

.stat-box {
    background: rgba(15,27,33,0.95);
    border-radius: 18px;
    padding: 25px 20px;
    text-align: center;
    color: #eee;
    width: 180px;
    box-shadow: 0 0 20px rgba(31,239,143,0.25);
    transition: transform 0.3s, box-shadow 0.3s;
}
.stat-box:hover {
    transform: translateY(-8px);
    box-shadow: 0 0 35px rgba(31,239,143,0.45);
}
.stat-box .icon {
    font-size: 42px;
    color: #1fef8f;
    margin-bottom: 10px;
}
.stat-box .count {
    font-size: 30px;
    font-weight: bold;
}
.stat-box p {
    font-size: 16px;
    opacity: 0.8;
}

/* نمودارها */
.charts-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 25px;
    margin-bottom: 50px;
}

.chart-box {
    background: rgba(15,27,33,0.95);
    padding: 20px;
    border-radius: 18px;
    width: 350px;
    text-align: center;
    box-shadow: 0 0 20px rgba(31,239,143,0.25);
}
.chart-box h3 {
    color: #1fef8f;
    margin-bottom: 15px;
}
.large {
    width: 100%;
}

/* کارت‌ها (اعضا و دوره‌ها) */
.cards-section {
    margin-bottom: 50px;
}
.cards-section h3 {
    color: #1fef8f;
    margin-bottom: 20px;
    text-align: center;
}
.cards-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
}
.card {
    background: rgba(15,27,33,0.95);
    padding: 20px;
    border-radius: 18px;
    width: 220px;
    box-shadow: 0 0 18px rgba(31,239,143,0.25);
    transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover {
    transform: translateY(-6px);
    box-shadow: 0 0 30px rgba(31,239,143,0.45);
}
.card h4 {
    color: #1fef8f;
    margin-bottom: 10px;
}
.card p {
    color: #eee;
    font-size: 14px;
    margin-bottom: 6px;
    line-height: 1.3;
}

/* Responsive */
@media(max-width:1050px){
    .stats-container, .charts-container, .cards-container {
        flex-direction: column;
        align-items: center;
    }
    .chart-box, .stat-box, .card {
        width: 80%;
        max-width: 350px;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('chartFundsCourse'), {
    type: 'doughnut',
    data: {
        labels: ['دارای دوره', 'بدون دوره'],
        datasets: [{
            data: [{{ total_active_funds }}, {{ total_funds|add:"-total_active_funds" }}],
            backgroundColor: ['#1fef8f', '#127657'],
            borderColor: '#000'
        }]
    },
    options: { plugins:{ legend:{labels:{color:'#eee'}} }, responsive:true }
});

new Chart(document.getElementById('chartFundLoans'), {
    type: 'bar',
    data: {
        labels: [{% for fund in funds %}'{{ fund.fund.name }}',{% endfor %}],
        datasets: [
            {
                label: 'وام‌ها',
                data: [{% for fund in funds %}{{ fund.NumberOfLoans }},{% endfor %}],
                backgroundColor: '#1fef8f'
            },
            {
                label: 'موجودی',
                data: [{% for fund in funds %}{{ fund.quantity }},{% endfor %}],
                backgroundColor: '#0bc47e'
            }
        ]
    },
    options:{ 
        plugins:{ legend:{labels:{color:'#eee'}}},
        scales:{ x:{ticks:{color:'#eee'}}, y:{ticks:{color:'#eee'}} }
    }
});

new Chart(document.getElementById('chartReportsTimeline'), {
    type: 'line',
    data: {
        labels: [{% for report in reports %}'{{ report.date }}',{% endfor %}],
        datasets: [{
            label: "گزارش‌ها",
            data: [{% for report in reports %}{{ report.count }},{% endfor %}],
            borderColor: '#1fef8f',
            backgroundColor: 'rgba(31,239,143,.23)',
            tension: .35,
            fill:true,
            pointRadius: 5
        }]
    },
    options:{
        plugins:{ legend:{labels:{color:'#eee'}} },
        scales:{ x:{ticks:{color:'#eee'}}, y:{ticks:{color:'#eee'}} }
    }
});
</script>

{% endblock %}
