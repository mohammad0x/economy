{% extends "base.html" %}

{% block title %}لیست گزارش‌ها{% endblock %}

{% block content %}
<style>
    /* استایل‌های اصلی جدول و دکمه‌ها از base.html یا CSS های عمومی که قبلاً ارائه شد، استفاده می‌کنند. */

    .export-link {
        display: inline-block;
        margin-right: 15px;
        color: #eee;
        transition: color 0.2s;
        text-decoration: none;
    }
    .export-link:hover {
        color: #fff;
    }
    .header-actions {
        display: flex;
        align-items: center;
    }
</style>
<table class="styled-table">
    <thead>
        <tr>
            <th>#</th>
            <th>مربوط به</th>
            <th>تاریخ</th>
            <th>موضوع</th>
            <th>آدرس</th>
            <th>عملیات</th>
        </tr>
    </thead>
    <tbody>
        {% for report in reports %} {# 'reports' از context_object_name در ReportListView می‌آید #}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ report.deprivation.name|default:"نامشخص" }}</td> 
            <td>{{ report.date|date:"Y/m/d" }}</td>
            <td>{{ report.subject|truncatewords:8 }}</td>
            <td>{{ report.address|truncatewords:5 }}</td>
            <td class="actions">
                <a href="{% url 'report-detail' report.pk %}" title="مشاهده"><i class="fa-solid fa-eye"></i></a>
                <a href="{% url 'report-update' report.pk %}" title="ویرایش"><i class="fa-solid fa-pen-to-square"></i></a>
                <a href="{% url 'report-delete' report.pk %}" title="حذف" class="delete"><i class="fa-solid fa-trash"></i></a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" style="text-align: center; padding: 20px;">
                هیچ گزارشی برای نمایش وجود ندارد.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block extra_js %}
<script>
    // --- کد مودال برای تأیید حذف ---
    var modal = document.getElementById("deleteModal");
    var btn = document.querySelectorAll(".delete"); // کلاس "delete" را به لینک‌های حذف در جدول می‌دهیم
    var span = document.getElementsByClassName("close-button")[0];
    var confirmBtn = document.getElementById("confirmDelete");
    var cancelBtn = document.getElementById("cancelDelete");
    
    // وقتی روی دکمه حذف کلیک می‌شود (لینک با کلاس delete)
    btn.forEach(function(element) {
        element.onclick = function(event) {
            event.preventDefault(); // از رفتن مستقیم به URL جلوگیری کن
            var deleteUrl = this.getAttribute('href');
            confirmBtn.setAttribute('href', deleteUrl); // لینک حذف را به دکمه تأیید مودال منتقل کن
            modal.style.display = "block";
        }
    });

    // بستن مودال با دکمه X
    span.onclick = function() {
        modal.style.display = "none";
    }

    // بستن مودال با دکمه انصراف
    cancelBtn.onclick = function() {
        modal.style.display = "none";
    }

    // بستن مودال وقتی کاربر بیرون از آن کلیک می‌کند
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    
    // --- (کد فیلتر کردن قبلی در اینجا قرار می‌گیرد) ---
</script>
{% endblock %}